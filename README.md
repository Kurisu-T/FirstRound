**已部署公网，在提交考核内容后，到答辩结束期间放行，链接：http://101.37.135.139:2333/**

**注：请将文档与 photos 放在同一级目录下，否则图片将无法正常加载**

### 项目背景

略

### 项目介绍

项目分为**用户端**和**管理端**，普通用户和管理员都可注册、登录以及修改个人信息。

**用户端：**用户端能够查看**正在上映**的电影信息、**个人订单**历史，同时能够购买电影票，实现**选座**、**模拟支付**以及**提交退票申请**等的功能，简单实现了在**用户登录后提醒用户订单中即将或正在放映的电影**功能。

注：为测试方便，普通用户可以自己修改账户余额

**管理端：**管理端可以查看**所有**的电影信息以及订单历史，同时实现了添加和编辑电影信息、**拉黑用户**以及**处理退票申请**等的功能。

### 技术结构

- 单模块结构，未使用任何框架
- 使用 **MySQL** 数据库存储数据
- 使用 **Redis** 作为缓存，引入 **Jedis** 依赖
- 使用**乐观锁**、**悲观锁**处理高并发查询电影信息。**注：**这里我先写了乐观锁，后写了悲观锁，主要是为了练手，一般并不会两种锁同时使用
- 利用 Redis 性质，简单解决**缓存穿透**问题
- 使用 Redis 中的 List 模拟**消息队列**，解决订单超时问题

### sql表简要说明

​	1.管理员数据表

<img src=".\photos\Snipaste_2025-04-05_17-03-44.png" alt="Snipaste_2025-04-05_17-03-44" style="zoom: 80%;" />

​	2.用户数据表，money 代表账户余额，status 代表账号的状态，status = 0 时，代表用户被加入黑名单，无法登录

<img src=".\photos\Snipaste_2025-04-05_17-04-13.png" alt="Snipaste_2025-04-05_17-04-13" style="zoom:80%;" />

​	3.电影数据表，hall 代表放映厅编号

![Snipaste_2025-04-05_17-04-55](.\photos\Snipaste_2025-04-05_17-04-55.png)

​	4.订单数据表，自上而下依次为 订单id、订单对应的用户id、订单创建时间、电影编号、放映厅、座位号、放映时间、结束时间、订单状态、支付金额

<img src=".\photos\Snipaste_2025-04-05_17-05-31.png" alt="Snipaste_2025-04-05_17-05-31" style="zoom:80%;" />

### 测试情况

#### 1.访问域名后进入登录界面

![Snipaste_2025-04-05_17-12-16](.\photos\Snipaste_2025-04-05_17-12-16.png)

#### 2.用户端

##### 1）注册

填写信息后，点击注册，便会弹出提示

![Snipaste_2025-04-05_17-14-04](.\photos\Snipaste_2025-04-05_17-14-04.png)

如果填写的手机号在数据库中**已存在**，则注册失败，并弹出提示

![Snipaste_2025-04-05_17-16-28](.\photos\Snipaste_2025-04-05_17-16-28.png)

##### 2）登录

填写信息登录成功后，页面跳转到用户页面，并展示用户信息和选项

![Snipaste_2025-04-05_17-17-35](.\photos\Snipaste_2025-04-05_17-17-35.png)

若填写错误信息或用户已被加入黑名单则会弹出提醒

![Snipaste_2025-04-05_17-20-10](.\photos\Snipaste_2025-04-05_17-20-10.png)

![Snipaste_2025-04-05_17-22-28](.\photos\Snipaste_2025-04-05_17-22-28.png)

##### 3）修改信息

填写要修改的信息后点击修改后，便可修改数据库信息，之后弹出提醒，同时自动刷新网页

![Snipaste_2025-04-05_17-17-40](.\photos\Snipaste_2025-04-05_17-17-40.png)

数据库更新

![Snipaste_2025-04-05_17-24-39](.\photos\Snipaste_2025-04-05_17-24-39.png)

##### 4）查看电影列表

跳转页面，**这里我只将后端响应的原始 json 数据展示出来，并没有做界面化设计，包括后面的订单数据和管理端查看用户列表等界面也同样**，注意这里**没有 3 号电影**，那是因为数据库中 3 号电影没有上映（指放映时间在用户查询数据时之前），用户可以在下方直接购票，也可在查询电影详细信息后，在详细信息页面购票

![Snipaste_2025-04-05_17-26-19](.\photos\Snipaste_2025-04-05_17-26-19.png)

##### 5）查询电影详细

![Snipaste_2025-04-05_17-30-27](.\photos\Snipaste_2025-04-05_17-30-27.png)

##### 6）购票

填写座位号后，点击购票，即可**生成订单信息**，同时，对应的电影库存 -1，并跳转支付界面。

此时，订单状态为 0，代表未支付，详细的订单状态码对应的含义可在源代码 utils 包下的 code 中查看，有注释，文档的最后我也会将放出来

![Snipaste_2025-04-05_17-33-45](.\photos\Snipaste_2025-04-05_17-33-45.png)

![Snipaste_2025-04-05_17-34-30](.\photos\Snipaste_2025-04-05_17-34-30.png)

**电影库存 -1 变为99**

![Snipaste_2025-04-05_17-41-43](.\photos\Snipaste_2025-04-05_17-41-43.png)

###### a.支付

**1.订单超时：**创建订单后，用户需要在一定时间内支付订单，否则订单将被判断为超时订单，消息队列会自动将订单状态改为已取消(status = 2)，用户将无法支付订单，同时该电影库存 +1

![Snipaste_2025-04-05_17-39-38](.\photos\Snipaste_2025-04-05_17-39-38.png)

![Snipaste_2025-04-05_17-40-42](.\photos\Snipaste_2025-04-05_17-40-42.png)

**2.支付成功：**支付成功后弹窗，同时跳转到用户的订单历史界面，此时，用户余额也相应减少，用户也**只有在支付订单后**才能申请退款。

![Snipaste_2025-04-05_17-41-50](.\photos\Snipaste_2025-04-05_17-41-50.png)

![Snipaste_2025-04-05_17-42-02](.\photos\Snipaste_2025-04-05_17-42-02.png)



![Snipaste_2025-04-05_17-45-54](.\photos\Snipaste_2025-04-05_17-45-54.png)

###### b.退款

（在进入订单历史界面后，可以通过订单 id 查询订单详细，并申请退款）

![Snipaste_2025-04-05_17-50-08](.\photos\Snipaste_2025-04-05_17-50-08.png)

![Snipaste_2025-04-05_17-51-35](.\photos\Snipaste_2025-04-05_17-51-35.png)

![Snipaste_2025-04-05_17-52-27](.\photos\Snipaste_2025-04-05_17-52-27.png)

**接下来将就交由管理端处理，这里暂时跳过，继续说明用户端功能**

###### c.余额不足

![Snipaste_2025-04-05_18-01-17](.\photos\Snipaste_2025-04-05_18-01-17.png)

###### d.库存不足

![Snipaste_2025-04-05_18-05-18](.\photos\Snipaste_2025-04-05_18-05-18.png)

###### e.座位被占用

![Snipaste_2025-04-05_18-07-39](.\photos\Snipaste_2025-04-05_18-07-39.png)



##### 7）订单历史、订单详细

购票中已有说明，不再介绍



#### 3.管理端

##### 1）登录、注册、修改信息

跟用户端用的是同一段代码，不再说明，这里只展示登陆后的管理端界面

![Snipaste_2025-04-05_18-34-21](.\photos\Snipaste_2025-04-05_18-34-21.png)

##### 2）订单管理

![Snipaste_2025-04-05_18-36-46](.\photos\Snipaste_2025-04-05_18-36-46.png)

##### 3）处理退款

![Snipaste_2025-04-05_18-39-12](.\photos\Snipaste_2025-04-05_18-39-12.png)

![Snipaste_2025-04-05_18-41-04](.\photos\Snipaste_2025-04-05_18-41-04.png)

![Snipaste_2025-04-05_18-41-38](.\photos\Snipaste_2025-04-05_18-41-38.png)

###### **1.同意退款**

![Snipaste_2025-04-05_18-42-31](.\photos\Snipaste_2025-04-05_18-42-31.png)

 ![Snipaste_2025-04-05_18-42-47](.\photos\Snipaste_2025-04-05_18-42-47.png)

![Snipaste_2025-04-05_18-43-43](.\photos\Snipaste_2025-04-05_18-43-43.png)

![Snipaste_2025-04-05_18-44-26](.\photos\Snipaste_2025-04-05_18-44-26.png)

![Snipaste_2025-04-05_18-45-38](.\photos\Snipaste_2025-04-05_18-45-38.png)

###### **2.拒绝退款**

![Snipaste_2025-04-05_18-48-06](.\photos\Snipaste_2025-04-05_18-48-06.png)

![Snipaste_2025-04-05_18-49-47](.\photos\Snipaste_2025-04-05_18-49-47.png)

![Snipaste_2025-04-05_18-50-28](.\photos\Snipaste_2025-04-05_18-50-28.png)

![Snipaste_2025-04-05_18-50-53](.\photos\Snipaste_2025-04-05_18-50-53.png)

##### 4）电影管理

![Snipaste_2025-04-05_18-54-24](.\photos\Snipaste_2025-04-05_18-54-24.png)



![Snipaste_2025-04-05_18-55-16](.\photos\Snipaste_2025-04-05_18-55-16.png)

###### 1.添加电影

![Snipaste_2025-04-05_18-58-41](.\photos\Snipaste_2025-04-05_18-58-41.png)

![Snipaste_2025-04-05_18-59-40](.\photos\Snipaste_2025-04-05_18-59-40.png)

![Snipaste_2025-04-05_19-06-42](.\photos\Snipaste_2025-04-05_19-06-42.png)

###### 2.编辑电影

![Snipaste_2025-04-05_19-09-16](.\photos\Snipaste_2025-04-05_19-09-16.png)

![Snipaste_2025-04-05_19-11-05](.\photos\Snipaste_2025-04-05_19-11-05.png)

![Snipaste_2025-04-05_19-11-39](.\photos\Snipaste_2025-04-05_19-11-39.png)

##### 5）用户管理

![Snipaste_2025-04-05_19-13-08](.\photos\Snipaste_2025-04-05_19-13-08.png)

![Snipaste_2025-04-05_19-17-55](.\photos\Snipaste_2025-04-05_19-17-55.png)

![Snipaste_2025-04-05_19-18-28](.\photos\Snipaste_2025-04-05_19-18-28.png)

![Snipaste_2025-04-05_19-19-10](.\photos\Snipaste_2025-04-05_19-19-10.png)



![Snipaste_2025-04-05_19-19-36](.\photos\Snipaste_2025-04-05_19-19-36.png)

#### 4.提醒功能

![Snipaste_2025-04-05_19-28-30](.\photos\Snipaste_2025-04-05_19-28-30.png)

![Snipaste_2025-04-05_19-31-12](.\photos\Snipaste_2025-04-05_19-31-12.png)

![Snipaste_2025-04-05_19-31-52](.\photos\Snipaste_2025-04-05_19-31-52.png)

#### 5.解决高并发购票问题

![Snipaste_2025-04-05_19-37-13](.\photos\Snipaste_2025-04-05_19-37-13.png)

#### 6.使用redis模拟消息队列处理超时订单

![Snipaste_2025-04-05_19-43-27](.\photos\Snipaste_2025-04-05_19-43-27.png)

#### 7.利用redis解决缓存穿透

这里只在根据id查询电影信息和更新电影信息中有写到，~~就当是练手了~~

![Snipaste_2025-04-05_19-48-55](.\photos\Snipaste_2025-04-05_19-48-55.png)

![Snipaste_2025-04-05_19-52-49](.\photos\Snipaste_2025-04-05_19-52-49.png)

#### 8.使用监听器自动更改电影结束后相关订单状态

**位于 utils 包下的 TicketListener 中**

![Snipaste_2025-04-05_19-57-11](.\photos\Snipaste_2025-04-05_19-57-11.png)
