<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>订单列表</title>
</head>
<body>
    <h2>订单历史</h2>
    <pre id="orderData"></pre>

    <script>
    // 页面加载时自动请求数据
    window.addEventListener('load', function() {
        fetch('/order/list', {
            method: 'GET',
            credentials: 'include'
        })
        .then(response => {
            if(response.status === 401) {
                window.location.href = '/login';
                return;
            }
            return response.json();
        })
        .then(data => {
            if(data.code === '500') {
                console.error('无权限', error);
                window.location.href = '/index.html';
                return;
            }
            const displayDiv = document.getElementById('orderData');
            if(data && data.code === 200) {
                displayDiv.textContent = JSON.stringify(data, null, 2);
            } else {
                displayDiv.textContent = data?.msg || '获取订单失败';
            }
        })
        .catch(error => {
            console.error('请求失败:', error);
            document.getElementById('orderData').textContent = '数据加载失败';
        });
    });
    </script>
</body>
</html>